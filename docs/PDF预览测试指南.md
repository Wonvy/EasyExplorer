# PDF 预览测试指南

## 快速测试步骤

### 1. 启动应用
```bash
npm run dev
```

### 2. 准备测试文件

在您的系统中准备以下类型的 PDF 文件：
- ✅ 单页 PDF（测试基本预览功能）
- ✅ 多页 PDF（测试翻页功能）
- ✅ 小文件 PDF（< 1MB）
- ✅ 大文件 PDF（> 5MB，测试性能）
- ⚠️ 加密/受保护的 PDF（测试错误处理）

### 3. 执行测试

#### 测试项 1：基本预览功能
1. 在文件浏览器中导航到包含 PDF 文件的目录
2. 点击一个 PDF 文件
3. **预期结果**：
   - 预览面板显示 PDF 图标和文件名
   - Canvas 区域显示 PDF 第一页内容
   - 底部显示文件信息（大小、创建时间等）

#### 测试项 2：多页翻页功能
1. 选择一个多页 PDF 文件
2. 观察翻页控制按钮（◀ 1 / 5 ▶）
3. 点击 ▶ 按钮翻到下一页
4. 点击 ◀ 按钮翻回上一页
5. **预期结果**：
   - 页面内容正确切换
   - 页码数字更新
   - 第一页时 ◀ 按钮禁用
   - 最后一页时 ▶ 按钮禁用

#### 测试项 3：加载状态
1. 选择一个大文件 PDF（> 5MB）
2. **预期结果**：
   - 加载时显示 "正在加载 PDF..." 提示
   - 加载完成后显示 PDF 内容
   - 加载过程中没有界面卡死

#### 测试项 4：错误处理
1. 尝试打开一个加密的 PDF 文件
2. 或者尝试打开一个损坏的 PDF 文件
3. **预期结果**：
   - 显示错误信息
   - 提供"使用默认程序打开"按钮作为备用方案
   - 应用不崩溃

#### 测试项 5：外部打开功能
1. 选择任意 PDF 文件
2. 点击"使用默认程序打开"按钮
3. **预期结果**：
   - 系统默认 PDF 阅读器打开该文件
   - 应用继续正常运行

#### 测试项 6：主题适配
1. 在浅色主题下预览 PDF
2. 切换到深色主题
3. 再次预览 PDF
4. **预期结果**：
   - PDF 内容在两种主题下都清晰可见
   - UI 元素适配主题颜色

## 常见问题排查

### 问题 1：PDF 预览显示空白

**可能原因**：
- PDF.js 未正确加载
- 文件路径错误
- PDF 文件损坏

**排查步骤**：
1. 打开浏览器开发者工具（F12）
2. 查看 Console 面板是否有错误信息
3. 确认是否看到 "✅ PDF.js 已加载" 消息
4. 尝试用其他 PDF 阅读器打开该文件

### 问题 2：翻页按钮不工作

**可能原因**：
- 事件监听器未正确绑定
- 页面渲染失败

**排查步骤**：
1. 打开开发者工具 Console
2. 查看是否有 JavaScript 错误
3. 确认 `pdf-prev` 和 `pdf-next` 元素是否存在

### 问题 3：加载非常慢

**可能原因**：
- PDF 文件过大
- 系统性能不足

**解决方案**：
- 对于大文件，考虑使用外部程序打开
- 未来版本将添加文件大小限制

### 问题 4：某些 PDF 无法预览

**可能原因**：
- PDF 格式不兼容
- 使用了特殊编码
- PDF 已加密

**解决方案**：
- 使用"外部打开"功能
- 查看 Console 错误信息
- 尝试转换 PDF 格式

## 性能基准

以下是不同大小 PDF 文件的预期性能：

| 文件大小 | 页数 | 加载时间 | 翻页响应 |
|---------|------|---------|---------|
| < 1MB   | 1-10 | < 1秒   | 即时    |
| 1-5MB   | 10-50| 1-3秒   | < 0.5秒 |
| 5-10MB  | 50+  | 3-5秒   | 0.5-1秒 |
| > 10MB  | 100+ | > 5秒   | 1-2秒   |

**注意**：实际性能取决于系统硬件和 PDF 内容复杂度。

## 开发者调试

### 启用详细日志

在 `src/renderer-tauri.js` 中，PDF 相关函数会输出以下日志：

```javascript
✅ PDF.js 已加载          // PDF.js 初始化成功
❌ PDF.js 加载失败        // PDF.js 加载失败
渲染 PDF 失败            // PDF 渲染出错
```

### 检查 PDF.js 版本

在 Console 中执行：
```javascript
console.log(pdfjsLib);
```

### 手动测试 PDF 渲染

在 Console 中执行：
```javascript
// 测试加载 PDF
const testPath = 'C:\\path\\to\\test.pdf';
renderPDFPreview(testPath, 'test.pdf', { size: 1024000 });
```

## 反馈问题

如果遇到问题，请提供以下信息：
1. 操作系统版本
2. PDF 文件大小和页数
3. 浏览器开发者工具的错误信息
4. 复现步骤
5. PDF 文件示例（如果可以分享）

## 成功标准

所有测试项通过即表示 PDF 预览功能正常工作：
- ✅ 可以预览单页和多页 PDF
- ✅ 翻页功能正常
- ✅ 错误情况有合理提示
- ✅ 外部打开功能可用
- ✅ 性能在可接受范围内
- ✅ 主题切换不影响预览

---

**测试完成日期**：_______________________

**测试人员**：_______________________

**测试结果**：□ 通过  □ 部分通过  □ 未通过

**备注**：


