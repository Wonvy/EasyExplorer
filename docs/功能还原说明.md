# 功能还原说明

## 概述
已成功将原 Electron 版本中的日历、年报和主题切换功能迁移到 Tauri 版本。

## 已还原的功能

### 1. 日历视图 📅
**功能描述**：
- 显示月历视图，以日历格式展示项目文件夹
- 支持按月份切换（上一月/下一月）
- 点击"今天"快速返回当前月份
- 在日历中显示每天的项目文件夹
- 双击文件夹可以打开该文件夹
- 点击日期右下角的"+"图标可以创建新的项目文件夹

**使用方法**：
1. 点击侧边栏"项目"选项卡下的"日历"按钮
2. 系统会读取 localStorage 中配置的项目路径（需要在设置中先配置）
3. 日历会显示当前年份和月份的项目
4. 项目文件夹命名格式：`MMDD-项目名称`（例如：1117-新项目）

**技术实现**：
- 使用 Tauri 的 `invoke` 调用 Rust 后端 API 读取目录
- 从文件夹名称中提取日期信息（MMDD格式）
- 如果文件夹名称不符合格式，使用文件创建时间作为日期
- 支持在指定日期创建新文件夹，自动添加日期前缀

### 2. 年报视图 📊
**功能描述**：
- 以时间轴形式展示整年12个月的项目概览
- 每个月份显示该月的所有项目文件夹
- 支持按年份切换（上一年/下一年）
- 点击项目可在右侧预览项目内容
- 双击项目在系统文件管理器中打开
- 支持鼠标拖拽或滚轮横向滚动时间轴

**使用方法**：
1. 点击侧边栏"项目"选项卡下的"年报"按钮
2. 系统会显示当前年份的所有月份
3. 每个月份下会列出该月的所有项目
4. 单击项目可查看预览，双击打开文件夹

**技术实现**：
- 遍历12个月的文件夹（1月、2月...12月）
- 使用 Tauri API 异步读取每个月份的项目
- 动态生成时间轴 HTML
- 实现项目预览功能，显示项目内的文件列表
- 支持鼠标拖拽滚动和滚轮滚动

### 3. 主题切换 🎨
**功能描述**：
- 支持亮色（Light）和暗色（Dark）主题切换
- 主题设置会保存到 localStorage
- 页面重新加载时自动应用上次选择的主题

**使用方法**：
1. 点击左下角的设置图标（齿轮图标）
2. 在弹出菜单中点击"切换主题"
3. 主题会立即切换，并自动保存

**技术实现**：
- 切换 `body` 元素的 `dark-theme` CSS 类
- 同时设置 `document.documentElement` 的 `data-theme` 属性
- 使用 localStorage 持久化主题选择
- 在初始化时读取并应用保存的主题

## 代码位置

### 前端代码
- **文件**：`src/renderer-tauri.js`
- **日历视图相关函数**：
  - `toggleCalendarView()` - 切换到日历视图
  - `showCalendarView()` - 显示日历
  - `changeMonth(delta)` - 切换月份
  - `goToToday()` - 返回今天
  - `showCreateFolderDialog()` - 创建文件夹对话框
  
- **年报视图相关函数**：
  - `showAnnualReport()` - 显示年报视图
  - `generateMonthsTimeline()` - 生成月份时间轴
  - `loadAnnualData(yearPath)` - 加载年度数据
  - `updateProjectPreview(projectPath)` - 更新项目预览
  - `changeReportYear(delta)` - 切换年份

- **主题切换相关函数**：
  - `toggleTheme()` - 切换主题
  - `initUI()` - 初始化 UI（包含主题应用）

### 后端代码
- **文件**：`src-tauri/src/main.rs`
- **相关命令**：
  - `read_directory` - 读取目录
  - `create_directory` - 创建目录
  - `path_exists` - 检查路径是否存在

## 配置要求

### 项目路径配置
日历和年报功能依赖于项目路径配置，需要在设置页面配置：

```javascript
// localStorage 中的配置格式
{
  "projectPaths": {
    "2023": "D:\\Projects\\2023",
    "2024": "D:\\Projects\\2024",
    "2025": "D:\\Projects\\2025"
  }
}
```

### 目录结构
项目目录应遵循以下结构：
```
项目根目录/
├── 1月/
│   ├── 0101-新年项目
│   ├── 0115-中旬项目
│   └── ...
├── 2月/
│   ├── 0201-二月项目
│   └── ...
...
└── 12月/
    └── ...
```

## 注意事项

1. **项目路径必须先配置**：在使用日历和年报功能前，必须在设置页面配置对应年份的项目路径
2. **文件夹命名规范**：为了正确显示在日历中，建议使用 `MMDD-名称` 格式命名文件夹
3. **月份文件夹**：系统会自动在年份目录下查找 `1月`、`2月` 等文件夹
4. **主题切换立即生效**：切换主题后无需刷新页面

## 测试建议

### 测试日历功能
1. 在设置中配置当前年份的项目路径
2. 确保路径下有月份文件夹（如"11月"）
3. 在月份文件夹中创建一些测试文件夹
4. 点击日历按钮，检查是否正确显示
5. 测试切换月份、返回今天、创建文件夹等功能

### 测试年报功能
1. 确保项目路径已配置
2. 在多个月份文件夹中创建测试项目
3. 点击年报按钮，检查时间轴是否正确显示
4. 测试滚动、切换年份、点击项目预览等功能

### 测试主题切换
1. 点击设置图标，选择"切换主题"
2. 检查页面是否正确切换为暗色/亮色主题
3. 刷新页面，检查主题是否保持
4. 多次切换，确保功能稳定

## 已知问题与改进方向

1. **样式适配**：部分 CSS 样式可能需要针对日历和年报视图进行调整
2. **性能优化**：当项目数量很多时，加载速度可能较慢，可以考虑添加加载动画
3. **错误处理**：当项目路径不存在时，应该有更友好的提示和引导
4. **国际化**：目前界面是中文，可以考虑添加多语言支持

## 更新日志

**2025-11-17**
- ✅ 完成日历视图功能迁移
- ✅ 完成年报视图功能迁移  
- ✅ 完成主题切换功能迁移
- ✅ 添加功能还原说明文档


