# 函数迁移清单

## 概述
本文档列出 `renderer.js` 中的所有功能函数，并标注哪些已在 `renderer-tauri.js` 中实现。

---

## 已实现的函数 ✅ (39个)

### 初始化相关
- ✅ `initTauriAPIs()` - Tauri API 初始化
- ✅ `initUI()` - UI 初始化
- ✅ `init()` - 主初始化函数

### 导航相关
- ✅ `navigateTo(newPath)` - 导航到指定路径
- ✅ `navigateBack()` - 后退
- ✅ `navigateForward()` - 前进
- ✅ `navigateUp()` - 向上
- ✅ `loadDrives()` - 加载驱动器

### UI 更新相关
- ✅ `updatePathBar(filepath)` - 更新路径栏
- ✅ `updateFileList(files)` - 更新文件列表
- ✅ `updateStatusBar(files)` - 更新状态栏
- ✅ `updateNavigationButtons()` - 更新导航按钮

### 文件操作相关
- ✅ `createFileItem(file)` - 创建文件项
- ✅ `openFile(file)` - 打开文件
- ✅ `selectFile(file, multiSelect)` - 选择文件
- ✅ `formatFileSize(bytes)` - 格式化文件大小
- ✅ `sortFiles(files)` - 排序文件

### 收藏夹相关
- ✅ `loadFavorites()` - 加载收藏夹
- ✅ `addToFavorites(filepath)` - 添加到收藏夹
- ✅ `removeFromFavorites(filepath)` - 从收藏夹移除

### 视图相关
- ✅ `setView(view)` - 设置视图模式
- ✅ `bindEvents()` - 绑定事件

### 主题相关
- ✅ `toggleTheme()` - 切换主题

### 设置相关
- ✅ `openSettings()` - 打开设置

### 右键菜单相关
- ✅ `showContextMenu(file, x, y)` - 显示右键菜单

### 文件夹分组相关
- ✅ `loadFolderGroups()` - 加载文件夹分组
- ✅ `createGroupElement(groupName, folders)` - 创建分组元素
- ✅ `showAddGroupDialog()` - 显示添加分组对话框

### 日历视图相关
- ✅ `toggleCalendarView()` - 切换日历视图
- ✅ `showCalendarView()` - 显示日历视图
- ✅ `changeMonth(delta)` - 切换月份
- ✅ `goToToday()` - 返回今天
- ✅ `handleCalendarScroll(e)` - 处理日历滚轮
- ✅ `showCreateFolderDialog(year, month, day)` - 显示创建文件夹对话框

### 年报视图相关
- ✅ `showAnnualReport()` - 显示年报
- ✅ `generateMonthsTimeline()` - 生成月份时间轴
- ✅ `loadAnnualData(yearPath)` - 加载年度数据
- ✅ `updateProjectPreview(projectPath)` - 更新项目预览
- ✅ `changeReportYear(delta)` - 切换年份

---

## 待实现的函数 ⏳ (57个)

### 高优先级 - 核心功能 🔴

#### 文件操作
1. ⏳ `copyFile(filePaths)` - 复制文件
2. ⏳ `pasteFile(targetDir, source)` - 粘贴文件
3. ⏳ `getFileDetails(dirPath, file)` - 获取文件详情

#### 右键菜单
4. ⏳ `showFavoriteContextMenu(favPath, x, y)` - 收藏夹右键菜单
5. ⏳ `showGroupFolderContextMenu(e, groupName, folderPath)` - 分组文件夹右键菜单
6. ⏳ `showGroupContextMenu(e, groupName)` - 分组右键菜单

#### 文件夹分组
7. ⏳ `createGroup(groupName)` - 创建分组
8. ⏳ `updateFolderGroups()` - 更新文件夹分组
9. ⏳ `addToGroup(groupName, folder)` - 添加到分组
10. ⏳ `handleAddToGroup(groupName)` - 处理添加到分组
11. ⏳ `removeFromGroup(groupName, folderPath)` - 从分组移除
12. ⏳ `showColorPicker(groupName)` - 显示颜色选择器
13. ⏳ `showRenameDialog(groupName)` - 显示重命名对话框
14. ⏳ `renameGroup(oldName, newName)` - 重命名分组
15. ⏳ `deleteGroup(groupName)` - 删除分组
16. ⏳ `moveGroup(groupName, direction)` - 移动分组

#### 预览功能
17. ⏳ `updatePreview(file)` - 更新预览
18. ⏳ `showFullscreenPreview(filePath)` - 全屏预览
19. ⏳ `hideFullscreenPreview()` - 隐藏全屏预览
20. ⏳ `showDefaultPreview(filePath, fileExt)` - 默认预览
21. ⏳ `handlePreviewContentClick(e)` - 预览内容点击
22. ⏳ `handlePreviewContentDblClick(e)` - 预览内容双击
23. ⏳ `handlePreviewContentMouseOver(e)` - 预览内容鼠标悬停
24. ⏳ `handlePreviewContentMouseOut(e)` - 预览内容鼠标移出
25. ⏳ `handlePreviewContentKeyDown(e)` - 预览内容键盘事件

#### 标签系统
26. ⏳ `handleTagClick(e)` - 标签点击
27. ⏳ `handleTagRightClick(e)` - 标签右键
28. ⏳ `updateFolderTag(folderElement)` - 更新文件夹标签
29. ⏳ `showTagView(color)` - 显示标签视图

---

### 中优先级 - 增强功能 🟡

#### 视图和排序
30. ⏳ `setViewMode(mode)` - 设置视图模式
31. ⏳ `sortGroupFiles(groupContent, sortType, isAscending)` - 分组文件排序
32. ⏳ `handleSortClick(sortMethod)` - 处理排序点击
33. ⏳ `groupFilesByType(files)` - 按类型分组文件

#### 时间线视图
34. ⏳ `createTimelineItems(fileDetails)` - 创建时间线项
35. ⏳ `toggleYearItems(e)` - 切换年份项
36. ⏳ `toggleMonthItems(e)` - 切换月份项
37. ⏳ `toggleDateItems(e)` - 切换日期项

#### 最近项目
38. ⏳ `updateRecentTab()` - 更新最近标签
39. ⏳ `updateQuickAccess()` - 更新快速访问

#### 拖拽调整大小
40. ⏳ `initResize(e)` - 初始化调整大小
41. ⏳ `resize(e)` - 调整大小
42. ⏳ `stopResize()` - 停止调整大小
43. ⏳ `initPreviewResize(e)` - 初始化预览调整大小
44. ⏳ `resizePreview(e)` - 调整预览大小
45. ⏳ `stopPreviewResize()` - 停止预览调整大小

#### 选择框
46. ⏳ `createSelectionBox(x, y)` - 创建选择框
47. ⏳ `updateSelectionBox(x, y)` - 更新选择框
48. ⏳ `removeSelectionBox()` - 移除选择框
49. ⏳ `isElementInSelectionBox(element, box)` - 判断元素是否在选择框内
50. ⏳ `selectItemsInBox()` - 选择框内的项
51. ⏳ `handleMouseDown(e)` - 鼠标按下
52. ⏳ `handleMouseMove(e)` - 鼠标移动
53. ⏳ `handleMouseUp(e)` - 鼠标松开

---

### 低优先级 - 辅助功能 🟢

#### 工具函数
54. ⏳ `formatDate(date)` - 格式化日期
55. ⏳ `formatTime(date)` - 格式化时间
56. ⏳ `debounce(func, wait)` - 防抖函数
57. ⏳ `getFileIcon(file)` - 获取文件图标
58. ⏳ `getUnknownIcon(ext, defaultIcon)` - 获取未知图标
59. ⏳ `getCurrentViewDataAttribute()` - 获取当前视图数据属性
60. ⏳ `validateAndInitData()` - 验证和初始化数据

#### 侧边栏
61. ⏳ `toggleSidebarSection(sectionId)` - 切换侧边栏区域
62. ⏳ `updateFavorites()` - 更新收藏夹显示

#### 驱动器
63. ⏳ `showDrives()` - 显示驱动器列表

#### 路径栏
64. ⏳ `handlePathFocus()` - 路径栏获得焦点
65. ⏳ `handlePathBlur()` - 路径栏失去焦点

#### 选中项导航
66. ⏳ `updateSelectedItem(newSelectedItem)` - 更新选中项
67. ⏳ `getNextSelectedItem()` - 获取下一个选中项
68. ⏳ `getPreviousSelectedItem()` - 获取上一个选中项

#### 主题
69. ⏳ `updateThemeButtonText()` - 更新主题按钮文本

#### 特殊功能
70. ⏳ `openWithSeer(filePath, seerPath)` - 使用 Seer 打开
71. ⏳ `convertToPdf(inputPath, outputPath)` - 转换为 PDF
72. ⏳ `createFolder(year, month, day, folderName)` - 创建文件夹（日历用）

---

## 迁移优先级建议

### 第一阶段 - 核心功能 (1-2周)
**目标**：实现基本的文件管理功能

1. **文件操作** (3个函数)
   - `copyFile` - 复制
   - `pasteFile` - 粘贴
   - `getFileDetails` - 文件详情

2. **选择框功能** (8个函数)
   - 框选多个文件
   - 批量操作基础

3. **右键菜单增强** (3个函数)
   - 完整的右键菜单系统

### 第二阶段 - 分组和标签 (1周)
**目标**：完善文件夹管理功能

4. **文件夹分组** (10个函数)
   - 完整的分组管理
   - 拖拽排序

5. **标签系统** (4个函数)
   - 文件标签功能

### 第三阶段 - 预览和视图 (1-2周)
**目标**：增强用户体验

6. **预览功能** (9个函数)
   - 文件预览
   - 全屏预览

7. **时间线视图** (4个函数)
   - 时间线展示

8. **视图切换** (4个函数)
   - 多种视图模式

### 第四阶段 - 辅助功能 (1周)
**目标**：完善细节

9. **拖拽调整大小** (6个函数)
10. **其他辅助功能** (15个函数)

---

## 特殊注意事项

### 需要 Rust 后端支持的功能
以下功能需要在 `src-tauri/src/main.rs` 中添加对应的命令：

1. **文件操作**
   - ✅ `copy_file` - 已实现
   - ⏳ `move_file` - 需要实现
   - ⏳ `get_file_metadata` - 需要实现

2. **图标提取**
   - ⏳ `extract_file_icon` - Windows 图标提取

3. **文件关联**
   - ⏳ `get_default_app` - 获取默认打开程序
   - ⏳ `open_with_app` - 使用指定程序打开

### 需要额外依赖的功能
1. **Sortable.js** - 拖拽排序
2. **Highlight.js** - 代码高亮预览
3. **PDF 转换** - 需要外部工具

### 可能需要重新设计的功能
1. **Everything 搜索** - Electron 专用，需要替代方案
2. **剪贴板扩展** - 需要使用 Tauri 剪贴板 API
3. **窗口快捷方式** - Windows 特定功能

---

## 函数依赖关系

### 核心依赖链
```
navigateTo
  ├─> updateFileList
  │     ├─> createFileItem
  │     └─> sortFiles
  ├─> updatePathBar
  ├─> updateStatusBar
  └─> updateNavigationButtons
```

### 预览依赖链
```
updatePreview
  ├─> getFileDetails
  └─> showDefaultPreview
        ├─> showFullscreenPreview
        └─> handlePreviewContentClick
```

### 分组依赖链
```
updateFolderGroups
  ├─> createGroupElement
  ├─> addToGroup
  └─> removeFromGroup
        └─> showGroupContextMenu
```

---

## 迁移检查清单

### 迁移前检查
- [ ] 阅读原函数实现
- [ ] 识别 Node.js/Electron 专用 API
- [ ] 确认 Tauri 替代方案
- [ ] 检查后端命令是否存在

### 迁移中检查
- [ ] 替换所有 `require()` 为 Tauri API
- [ ] 替换 `fs` 为 `invoke('command')`
- [ ] 替换 `ipcRenderer` 为 Tauri 事件
- [ ] 替换 `shell` 为 Tauri shell API
- [ ] 添加 async/await
- [ ] 添加错误处理

### 迁移后检查
- [ ] 函数功能完整
- [ ] 错误处理完善
- [ ] 性能可接受
- [ ] 通过测试
- [ ] 更新文档

---

## 进度跟踪

### 总体进度
- **已完成**: 39 / 96 函数 (40.6%)
- **待完成**: 57 / 96 函数 (59.4%)

### 按类别进度
- ✅ 初始化: 3/3 (100%)
- ✅ 导航: 5/6 (83.3%)
- ✅ 日历视图: 6/6 (100%)
- ✅ 年报视图: 5/5 (100%)
- ⏳ 文件操作: 5/8 (62.5%)
- ⏳ 预览功能: 0/9 (0%)
- ⏳ 分组管理: 3/13 (23.1%)
- ⏳ 标签系统: 0/4 (0%)
- ⏳ 选择框: 0/8 (0%)
- ⏳ 视图切换: 1/5 (20%)
- ⏳ 辅助功能: 11/38 (28.9%)

---

## 下一步行动

### 立即开始
1. 实现文件复制粘贴功能
2. 实现框选功能
3. 完善右键菜单

### 本周完成
- 第一阶段核心功能
- 基本的分组管理

### 本月完成
- 完整的分组和标签系统
- 预览功能
- 时间线视图

---

**文档更新**: 2025-11-17  
**当前进度**: 40.6%  
**预计完成**: 2025-12月


